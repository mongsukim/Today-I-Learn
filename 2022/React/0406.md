## 📆 2022-04-06 (수) TIL

### 🔥 오늘 한 일 <br>

```useEffect``` 가 아닌 ```useQuery``` 커스텀 훅으로 데이터 받아오도록 변경함


#### 기존에 데이터 받아오던 방식 : useEffect

apiHomepage.tsx (axios 통신코드 모아두는 곳)
```js
export const getMeetingDemoList: Function = async (token: string = TOKEN) => {
    console.log("API함수 /meetingDemo/getMeetingDemoList");
    return await axios.get(APIADDRESS + "/meetingDemo/getMeetingDemoList?accessToken=" + token);
};
```


DemoLists.tsx

```js
... 리액트 코드 생략

    const [ demoList, setDemoList ] = useState<any>(); //받아온 데이터값을 받는 배열

    useEffect(()=>{
         apiHomepage.getMeetingDemoList() //위의 axios함수 호출
         .then((result) => {
             console.log('getDemoList datadata', result.data.data)
             const keyArr = result.data.data.map((data,index)=>{ //table에 key값을 생성해야 해서 결과에 key값을 추가된 배열 KeyArr을 생성한다.
                 return{
                     email: data.meetingApplicantEmail,
                     Institude: data.meetingApplicantInstitude,
                     Interests: data.meetingApplicantInterests,
                     JobTitle: data.meetingApplicantJobTitle,
                     Name: data.meetingApplicantName,
                     PhoneNum: data.meetingApplicantPhoneNum,
                     Questions: data.meetingApplicantQuestions,
                     RegDateTime: data.meetingApplicantRegDateTime,
                     userSeq: data.meetingApplicantSeq,
                     meetingPreferredDateTime: data.meetingPreferredDateTime,
                     // meetingApplicantConsentUsePersonalInfo: data.meetingApplicantConsentUsePersonalInfo,
                     // 개인정보수집동의는 무조건 필수값(Y)이므로 페이지 표에 표기하지 않음
                     meetingApplicantConsentUseMarketing: data.meetingApplicantConsentUseMarketing,
                     key:index
                 }
             })
             console.log('keyArr',keyArr)
             setDemoList(keyArr) // demoList를 set한다
         }).catch(error =>{
             console.log('에러', error)
             }
         )
     }, [setDemoList]);
```

기존엔 위에서 return한 값들을 테이블의 ```dataSource``` 로 넣어주었다. 
```js
 <Table
            columns={columns}
            rowSelection={rowSelection}
            dataSource={demoList}
            loading={loading}
            onChange={onChange}
            pagination={{pageSize:20}}
        />
```

### 새로운 방식 : useQuery 커스텀 훅 사용 

demoHooks.ts
```js
import {useQuery} from "react-query";
import { DemoList } from "../types";
import {getMeetingDemoList} from "../../../lib/apiHomepage";

export enum DemoKeysEnum {
    DemoList = 'demoList',
}


export const useGetDemoList = ( token: string | undefined) => {
    return useQuery(
        [DemoKeysEnum.DemoList], async () => {
            const res = await getMeetingDemoList(token)
            console.log('데모리스트', res.data.data)
            return res.data.data as DemoList[]
        }, {
            select: (datas) => datas.map((data,index) =>({...data,key:index})) //받아온 데이터에 key값을 넣어주는 코드
        }
    )
}

```

DemoList.tsx

```js
import {useAuthStore} from "../../store/authHooks"; //로그인 관련 훅 
import {useGetDemoList} from "../../api/hooks/Demo/demoHooks"; // 데모리스트 조회하는 훅 

const HomepageDemoLists: FC = () => { // HomepageDemoLists라는 컴포넌트이다. 
  const user = useAuthStore(state => state.user)
  const {data: demoData} = useGetDemoList(user?.accessToken) // useEffect로 불러오던 방식이 이 코드 하나로 해결된다 ! 
  const [ demoList, setDemoList ] = useState<any>();

 //생략
   return (
        <div className={Styles.page_wrap}>
        <h2 className={Styles.admin_title}>Meeting / Demo List</h2>
        <p className={Styles.admin_txt}>홈페이지에서 신청된 미팅/데모 목록을 조회한다.</p>
        <Table
            columns={columns}
            rowSelection={rowSelection}
            dataSource={demoData} // useGetDemoList로 가져온 데이터를 테이블 소스로 활용한다.
            loading={loading}
            onChange={onChange}
            pagination={{pageSize:20}}
        />
        {/* <Button onClick={publicDelete} type="primary" danger >
          선택삭제
        </Button>    */}
       
    </div>
    )
```
