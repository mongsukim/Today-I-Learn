## ğŸ“† 2022-04-06 (ìˆ˜) TIL

### ğŸ”¥ ì˜¤ëŠ˜ í•œ ì¼ <br>

1. ```useEffect``` ê°€ ì•„ë‹Œ ```useQuery``` ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë°ì´í„° ë°›ì•„ì˜¤ë„ë¡ ë³€ê²½í•¨
2. ë‰´ìŠ¤ ìˆ˜ì •ë¶€ë¶„ useMutation ì•ˆë˜ë˜ ì  ìˆ˜ì •í•¨! (ì›ì¸ : dataì— Formdataë¥¼ ëŒ€ì…í•´ì•¼ í–ˆë‹¤ )
3. Demolist.jsë¥¼ .tsxë¡œ ë³€ê²½ ë° usequery ì ìš©
4. userServeiceHistory.jsë¥¼ .tsxë¡œ ë³€ê²½ ë° react-query ì ìš©


<hr>

## 1. ê¸°ì¡´ì— ë°ì´í„° ë°›ì•„ì˜¤ë˜ ë°©ì‹ : useEffect

apiHomepage.tsx (axios í†µì‹ ì½”ë“œ ëª¨ì•„ë‘ëŠ” ê³³)
```js
export const getMeetingDemoList: Function = async (token: string = TOKEN) => {
    console.log("APIí•¨ìˆ˜ /meetingDemo/getMeetingDemoList");
    return await axios.get(APIADDRESS + "/meetingDemo/getMeetingDemoList?accessToken=" + token);
};
```


DemoLists.tsx

```js
... ë¦¬ì•¡íŠ¸ ì½”ë“œ ìƒëµ

    const [ demoList, setDemoList ] = useState<any>(); //ë°›ì•„ì˜¨ ë°ì´í„°ê°’ì„ ë°›ëŠ” ë°°ì—´

    useEffect(()=>{
         apiHomepage.getMeetingDemoList() //ìœ„ì˜ axiosí•¨ìˆ˜ í˜¸ì¶œ
         .then((result) => {
             console.log('getDemoList datadata', result.data.data)
             const keyArr = result.data.data.map((data,index)=>{ //tableì— keyê°’ì„ ìƒì„±í•´ì•¼ í•´ì„œ ê²°ê³¼ì— keyê°’ì„ ì¶”ê°€ëœ ë°°ì—´ KeyArrì„ ìƒì„±í•œë‹¤.
                 return{
                     email: data.meetingApplicantEmail,
                     Institude: data.meetingApplicantInstitude,
                     Interests: data.meetingApplicantInterests,
                     JobTitle: data.meetingApplicantJobTitle,
                     Name: data.meetingApplicantName,
                     PhoneNum: data.meetingApplicantPhoneNum,
                     Questions: data.meetingApplicantQuestions,
                     RegDateTime: data.meetingApplicantRegDateTime,
                     userSeq: data.meetingApplicantSeq,
                     meetingPreferredDateTime: data.meetingPreferredDateTime,
                     // meetingApplicantConsentUsePersonalInfo: data.meetingApplicantConsentUsePersonalInfo,
                     // ê°œì¸ì •ë³´ìˆ˜ì§‘ë™ì˜ëŠ” ë¬´ì¡°ê±´ í•„ìˆ˜ê°’(Y)ì´ë¯€ë¡œ í˜ì´ì§€ í‘œì— í‘œê¸°í•˜ì§€ ì•ŠìŒ
                     meetingApplicantConsentUseMarketing: data.meetingApplicantConsentUseMarketing,
                     key:index
                 }
             })
             console.log('keyArr',keyArr)
             setDemoList(keyArr) // demoListë¥¼ setí•œë‹¤
         }).catch(error =>{
             console.log('ì—ëŸ¬', error)
             }
         )
     }, [setDemoList]);
```

ê¸°ì¡´ì—” ìœ„ì—ì„œ returní•œ ê°’ë“¤ì„ í…Œì´ë¸”ì˜ ```dataSource``` ë¡œ ë„£ì–´ì£¼ì—ˆë‹¤. 
```js
 <Table
            columns={columns}
            rowSelection={rowSelection}
            dataSource={demoList}
            loading={loading}
            onChange={onChange}
            pagination={{pageSize:20}}
        />
```

### ìƒˆë¡œìš´ ë°©ì‹ : useQuery ì»¤ìŠ¤í…€ í›… ì‚¬ìš© 

demoHooks.ts
```js
import {useQuery} from "react-query";
import { DemoList } from "../types";
import {getMeetingDemoList} from "../../../lib/apiHomepage";

export enum DemoKeysEnum {
    DemoList = 'demoList',
}


export const useGetDemoList = ( token: string | undefined) => {
    return useQuery(
        [DemoKeysEnum.DemoList], async () => {
            const res = await getMeetingDemoList(token)
            console.log('ë°ëª¨ë¦¬ìŠ¤íŠ¸', res.data.data)
            return res.data.data as DemoList[]
        }, {
            select: (datas) => datas.map((data,index) =>({...data,key:index})) //ë°›ì•„ì˜¨ ë°ì´í„°ì— keyê°’ì„ ë„£ì–´ì£¼ëŠ” ì½”ë“œ
        }
    )
}

```

DemoList.tsx

```js
import {useAuthStore} from "../../store/authHooks"; //ë¡œê·¸ì¸ ê´€ë ¨ í›… 
import {useGetDemoList} from "../../api/hooks/Demo/demoHooks"; // ë°ëª¨ë¦¬ìŠ¤íŠ¸ ì¡°íšŒí•˜ëŠ” í›… 

const HomepageDemoLists: FC = () => { // HomepageDemoListsë¼ëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤. 
  const user = useAuthStore(state => state.user)
  const {data: demoData} = useGetDemoList(user?.accessToken) // useEffectë¡œ ë¶ˆëŸ¬ì˜¤ë˜ ë°©ì‹ì´ ì´ ì½”ë“œ í•˜ë‚˜ë¡œ í•´ê²°ëœë‹¤ ! 
  const [ demoList, setDemoList ] = useState<any>();

 //ìƒëµ
   return (
        <div className={Styles.page_wrap}>
        <h2 className={Styles.admin_title}>Meeting / Demo List</h2>
        <p className={Styles.admin_txt}>í™ˆí˜ì´ì§€ì—ì„œ ì‹ ì²­ëœ ë¯¸íŒ…/ë°ëª¨ ëª©ë¡ì„ ì¡°íšŒí•œë‹¤.</p>
        <Table
            columns={columns}
            rowSelection={rowSelection}
            dataSource={demoData} // useGetDemoListë¡œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ í…Œì´ë¸” ì†ŒìŠ¤ë¡œ í™œìš©í•œë‹¤.
            loading={loading}
            onChange={onChange}
            pagination={{pageSize:20}}
        />
        {/* <Button onClick={publicDelete} type="primary" danger >
          ì„ íƒì‚­ì œ
        </Button>    */}
       
    </div>
    )
```


<hr>

## 2. ë‰´ìŠ¤ ìˆ˜ì •ë¶€ë¶„ useMutationì´ ì•ˆë¬ë˜ ì´ìœ !

1. íŒŒë¼ë¯¸í„°ë¥¼ numberë¡œ ë³´ë‚´ì•¼ í•˜ëŠ”ë° stringìœ¼ë¡œ ë³´ë‚´ì„œì˜€ë‹¤.
- ê¸°ì¡´ ì½”ë“œì—” apií˜¸ì¶œì§ì „ í˜• ë³€í™˜ì„ í•˜ëŠ” ì½”ë“œë¥¼ ì¨ì¤¬ì—ˆëŠ”ë°, 
 useMutation í˜¸ì¶œí•˜ë©´ì„œëŠ” í˜•ë³€í™˜ ì½”ë“œê°€ ì ìš©ì´ ë˜ì§€ ì•Šì•˜ë‹¤.

#### í•´ê²°ë°©ë²• : inputì˜ valueì— ë°”ë¡œ í˜•ë³€í™˜ì„ í•´ì¤¬ê³ , typeë„ numberë¡œ ì„¤ì •í•˜ì˜€ë‹¤.

```js
 <input
  name="newsId"
  type="number"
  onChange={onChange}
  value={Number(newsView.newsId)}
  ref={register({
  required:true
 })} 
/>
```
### types.ts ì— interface ì„ ì–¸ì„ ë°”ê¾¸ì–´ ì¤€ë‹¤.

```js
export interface UpdateNewsParams {
    token: string,
    data: FormData // ì•„ë˜ ì½”ë“œ ê¸°ì¡´ ì„ ì–¸ ë§ê³  FormDataë¡œ ì„¤ì •í•œë‹¤.
    // data:{ 
    //     newsId: number
    //     newsTitle: string
    //     newsContents: string
    //     link: string
    //     file: string | any
    //     category: string
    //     thumnail:string
    // }
}
```

### mutateì˜ ë°ì´í„°ë¥¼ FormDataë¡œ ì§€ì •í•´ ì¤€ë‹¤.

```js
//ì œì‘í•œ ë‰´ìŠ¤ ì„œë²„ë¡œ ì „ì†¡

    const {mutate} = useUpdateNewsEN() // useMutation ì»¤ìŠ¤í…€ í›… í˜¸ì¶œ

    const UpdateForm = data => {
        const Formdata = new FormData();
        Formdata.append("newsId", data.newsId);
        Formdata.append("newsTitle", data.newsTitle);
        Formdata.append("newsContents", quillValue);
        Formdata.append("link", data.link);
        Formdata.append("category", data.category);
        Formdata.append("file", data.file);
        Formdata.append("thumnail", data.thumnail);
        console.log('homepagenewsupdatetsxì—ì„œë³´ë‚¸ë°ì´í„°',Formdata)
        mutate(
            {token: user!.accessToken, data: Formdata}, { //mutateì˜ ë°ì´í„°ë¥¼ FormDataë¡œ ì§€ì •í•´ ì¤€ë‹¤.
                onSuccess: (data) => {
                    //@ts-ignore
                    history.push('/HomepageNewsLists')
                },
                onError: (error) => {
                    //@ts-ignore
                    alert('ë‰´ìŠ¤ë“±ë¡ ì‹¤íŒ¨',error)
                }
            }
        )
    }
```



ì»¤ìŠ¤í…€ í›…

```js
import {useMutation, useQuery, useQueryClient} from "react-query";
import {NewsList, NewsContent, UpdateNewsParams } from "../types";
import {getNewsContentKR, getNewsContentEN, getNewsListLang, updateNews_, updateNewsKR_, setNews_, setNewsKR_,deleteNews,deleteNewsKR} from "../../../lib/apiHomepage";

export enum NewsKeysEnum {
    NewsList = 'newsList',
}

export enum NewsContentKeyEnum{
    NewsContent = 'newsContent'
}


export const useUpdateNewsEN = () =>{
    const queryClient = useQueryClient()
        return useMutation(({data, token}: UpdateNewsParams) => updateNews_(data, token),
        {
            onSuccess: (data) => {
                console.log('ì˜ë¬¸ë‰´ìŠ¤ ìˆ˜ì • ì„±ê³µ', data)
                return (
                    queryClient.invalidateQueries(NewsContentKeyEnum.NewsContent)
                )
            },
            onError: (error) => {
                console.log('ì˜ë¬¸ë‰´ìŠ¤ ìˆ˜ì • ì‹¤íŒ¨', error)
            }
        }
    )
}
```
apihomepage.tsx

```js
// ë‰´ìŠ¤ ìˆ˜ì •(ì˜ë¬¸)
export const updateNews_ : Function = async( data, token = TOKEN) => {
	console.log("APIí•¨ìˆ˜ /home/updateNews_");
	return await axios.post(APIADDRESS + "/home/updateNews_?lang=EN&accessToken="+ token, data,{
		headers: { "content-type":"multipart/form-data" }	
    }).catch(function(error){
        console.log('ì˜ë¬¸ë‰´ìŠ¤ìˆ˜ì •ì—ëŸ¬',error)
        console.log('ì˜ë¬¸ë‰´ìŠ¤ë³´ë‚¸ë°ì´í„°',data)
    })
};
```

ê¸°íƒ€ ìœ ì˜ì‚¬í•­ : 
ë°±ì—”ë“œ ì½”ë“œ ë””ë²„ê¹…í• ë•Œ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰í•  ê²ƒ. 
