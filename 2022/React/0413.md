## ğŸ“† 2022-04-13 (ìˆ˜) TIL

### ğŸ”¥ ì˜¤ëŠ˜ í•œ ì¼ <br>

1. reactì—ì„œ Form ì œì¶œ( ë°ì´í„° ì „ì†¡í•˜ê¸° )

ì˜¤ëŠ˜ì˜ ì˜¤ë¥˜ :  
FormDataëŠ” multipart-formdataë¥¼ ë³´ë‚¼ë•Œ ì“°ì. íŒŒì¼ ì•ˆ ë³´ë‚´ëŠ”ë° Formdataë¥¼ ì¨ì„œ 500ì—ëŸ¬ê°€ ë‚˜ì™”ë‹¤.


ë‚´ê°€ ë‹¤ë¤„ë³¸ ê²½ìš°ëŠ”
1. ```input type="file"``` ì´ ìˆëŠ” ê²½ìš° (multipart-formdata) ì™€,
2. ```file``` ì—†ì´ string, number ê°’ì„ ì „ì†¡í•˜ëŠ” ê²½ìš° (application/json)

ì´ë ‡ê²Œ 2ê°€ì§€ê°€ ìˆì—ˆë‹¤.

multipart-formdataë¥¼ ë³´ë‚¼ ë• ë¦¬ì•¡íŠ¸ ```useForm``` í›…ì„ ì‚¬ìš©í–ˆê³   
application/json ìœ¼ë¡œ ë³´ë‚¼ ë• ì¼ë°˜ inputì„ ì‚¬ìš©í–ˆë‹¤.   

### multipart-formdataë¡œ ë³´ë‚´ê¸° 



newsHooks.ts
```js

interface SetNewsParams {
    token: string,
    data: FormData //ì „ì†¡í•˜ëŠ” ë°ì´í„°ëŠ” FormData
}

export enum NewsKeysEnum {
    NewsList = 'newsList',
}

//ì˜ë¬¸ë‰´ìŠ¤ 1ê°œë“±ë¡
export const useRegistNewsEN = () => {
    const queryClient = useQueryClient()
    return useMutation(({token, data}: SetNewsParams) => setNews_(data, token),
        {
            onSuccess: (newPost) => {
                console.log('ì„±ê³µ', newPost)
                return (
                    queryClient.invalidateQueries(NewsKeysEnum.NewsList)
                )
            },
            onError: () => {
                console.log('ì‹¤íŒ¨')
            }
        }
    )
}


```



NewsRegist.tsx

```js
// ê¸°íƒ€ ì½”ë“œëŠ” ìƒëµí•¨. ë¡œì§ì— í•„ìš”í•œ ì½”ë“œë§Œ í‘œê¸°í•¨

import {useSetResearch} from "../../api/hooks/publication/publicationHooks";
 
const HomepageNewsRegist: FC = () => {
  const user = useAuthStore(state => state.user)
  const {mutate} = useRegistNewsEN() // mutateì½”ë“œê°€ ì‹¤í–‰ëœë‹¤(ë‰´ìŠ¤ ë“±ë¡í•˜ëŠ” ì½”ë“œ)
  // useForm hooks
  const {register, handleSubmit, formState, errors, control} = useForm();
  
  // íŒŒì¼ì„ ì²¨ë¶€í•˜ëŠ” ì½”ë“œ
  useEffect(() => {
        register({ name : "file" })
    },[register])
    
   // formdataì— ë‹´ì•„ muteteì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.
   const UpdateForm = data => {
        const Formdata = new FormData(); //Formdata ì‚¬ìš©
        Formdata.append("newsTitle",data.newsTitle); //inputì˜ nameì†ì„±ì— ìˆëŠ” ë‚´ìš©ì„ ë³´ëƒ„
        Formdata.append("newsContents", quillValue );
        Formdata.append("regDttm", data.regDttm);
        Formdata.append("file", data.file);
        Formdata.append("category", data.category );
        console.log('ë‰´ìŠ¤ì—…ë°ì´íŠ¸ë°ì´í„°',Formdata)

        mutate(
            {token: user!.accessToken, data: Formdata}, {
                onSuccess: (data) => {
                    //@ts-ignore
                    history.push('/HomepageNewsLists')
                },
                onError: (error) => {
                    //@ts-ignore
                    alert('ë‰´ìŠ¤ë“±ë¡ ì‹¤íŒ¨',error)
                }
            }
        )
    }
    
    // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
    return (
        <div className={Styles.page_wrap}>
            <h2 className={Styles.admin_title}>EN News Regist</h2>
            <p className={Styles.admin_txt}>ìƒˆ ì˜ë¬¸ ë‰´ìŠ¤ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</p>
            <Form 
            onFinish={handleSubmit((data)=> //useForm
                {UpdateForm(data)})} //UpdateForm í•¨ìˆ˜ ì‹¤í–‰ 
             encType="multipart/form-data" //encType ì„¤ì •
            >
                <Form.Item 
                    label="Title">
                    <input
                        className="inputsize"
                        type="text"
                        name="newsTitle" 
                        ref={register({ // ref=registerë¥¼ ì¨ì£¼ì–´ì•¼ formdataì— ì œì¶œëœë‹¤.
                            required:true
                        })}     
                    />
                 
                </Form.Item>
                <Form.Item label="ì‚¬ì§„ ì—…ë¡œë“œ(íŒŒì¼ëª…ì€ ì˜ì–´ë¡œ)">
                    <input
                    type="file"
                    name="file"
                    onChange={e => 
                        {
                            if(e.target.files == null){
                                return
                            } else{
                                setValue("file", e.target.files[0]) //useForm setvalue
                                encodeFileToBase64(e.target.files[0])
                            }
                        }
                    }
                    />
                </Form.Item>
              
                <Form.Item
                    label="í‚¤ì›Œë“œ">
                    <input
                        className="inputsize"
                        type="text"
                        name="category"
                        placeholder="ë‰´ìŠ¤ í‚¤ì›Œë“œ ì…ë ¥(ë‹¨ì–´)"
                        ref={register()}  
                    />
                </Form.Item>
                <Form.Item label="ë‚´ìš©">
                <Controller
                    name="newsContents"     
                    control={control}                    
                    defaultValue=""
                    render={()=>(
                        <ReactQuill
                            theme="snow"
                            value={quillValue}
                            onChange={setQuillValue}
                            modules={quillModules}
                            className="QuillCSS"
                        />
                    )}
                    />  
                </Form.Item>

                <Form.Item {...tailLayout}>
                    <Button type="primary" htmlType="submit" // submit 
                    className={Styles.admin_btn_margin}>
                        ë‰´ìŠ¤ ë“±ë¡
                    </Button>
                    <Button onClick={() => history.goBack()}>
                        ì·¨ì†Œ
                    </Button>
                </Form.Item>                
            </Form>            
        </div>
    );
};
  

```



### application/jsonìœ¼ë¡œ ë³´ë‚´ê¸° 


userHooks.ts

```js

// (dataë¡œ ë³´ë‚´ëŠ” ê°’)
 interface SetUserParams {
    data: {
        nationCode: string
        userEmail: string
        userPw: string
        userName: string
        userNum: string
        institude: string
    }
}

export enum UserKeysEnum {
    UserList = 'userList',
 }

export const useRegistUser = () => {
    const queryClient = useQueryClient()
    return useMutation(({data}: SetUserParams) => addUser(data),
        {
            onSuccess: (data) => {
                alert('í™ˆí˜ì´ì§€ìœ ì € ë“±ë¡ì„±ê³µ')
                return (
                    queryClient.invalidateQueries(UserKeysEnum.UserList)
                )
            },
            onError: () => {
                console.log('í™ˆí˜ì´ì§€ ìœ ì € ë“±ë¡ì‹¤íŒ¨')
            }
        }
    )
}
```



Regist.tsx
```js

import {useRegistUser} from '../../api/hooks/user/userHooks';


function Regist() {

const { register, handleSubmit, setValue, control, errors } = useForm();
const {mutate} = useRegistUser()

const UpdateForm = data => {
  mutate(
      {data: data}, { //ë³´ë‚´ëŠ” ë°ì´í„°ëŠ” ìœ„ì—ì„œ ì •ì˜í•œ SetUserParams ì´ë‹¤.
          onSuccess: (data) => {
          },
          onError: (error) => {
              //@ts-ignore
              alert('ì‚¬ìš©ì ì¶”ê°€ ì‹¤íŒ¨',error)
          }
      }
  )
}

//ìƒëµ
 return (
      <Form onFinish={handleSubmit((data)=> {UpdateForm(data)})} //encType ì„¤ì • ì•ˆí•¨.
      {...layout.head} 
      name="basic">
        <Form.Item
          label="ì•„ì´ë””(Email)"
          name={['userEmail']}
          rules={[{ required: true, message: 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”' }]}
        >
          <input  
          name="userEmail"
          placeholder="example@medicalip.com" 
          onChange={inputChange} 
          ref={register({
            required:true
        })} 
        />
        </Form.Item>
        <Form.Item
          label="ë¹„ë°€ë²ˆí˜¸"
          name={['userPw']}
          rules={[
            {
              required: true,
              message:
                'ì˜ë¬¸,ìˆ«ì,íŠ¹ìˆ˜ë¬¸ì ì¡°í•© 6ì ì´ìƒ 12ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”',
            },
          ]}
        >
          <input 
          placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
          name="userPw"
          ref={register({
            required:true
          })} 
          />
        </Form.Item>
        <Form.Item
          label="ë¹„ë°€ë²ˆí˜¸í™•ì¸"
          name={['userPwCheck']}
          rules={[{ required: true, message: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”' }]}
        >
          <Input.Password size="large" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸" onChange={inputChange} />
        </Form.Item>
        <Form.Item
          label="ì´ë¦„"
          name={['userName']}
          rules={[{ required: true, message: 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”' }]}
        >
          <input 
          name="userName"
          placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" 
          onChange={inputChange} 
            ref={register({
              required:true
            })} 
          />
        </Form.Item>
        <Form.Item
          label="íœ´ëŒ€í°ë²ˆí˜¸"
          name={['userNum']}
          rules={[{ required: true, message: 'íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”' }]}
        >
          <input 
            name="userNum"
            placeholder="ë²ˆí˜¸ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”" 
            onChange={inputChange} 
            ref={register({
              required:true
            })} 
          />
        </Form.Item>
        <Form.Item
          label="ê¸°ê´€"
          name={['institude']}
          rules={[{ required: true, message: 'ê¸°ê´€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”' }]}
        >
          <input 
            name="institude"
            placeholder="ê¸°ê´€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
            onChange={inputChange} 
            ref={register({
            required:true
          })} 
          />
        </Form.Item>

```
